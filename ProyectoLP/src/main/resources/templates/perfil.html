<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Editar Perfil | InnovatechX</title>
                
   
        <link href="https://fonts.googleapis.com/css2?family=Epilogue&family=VT323&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bebas+Neue&family=Merriweather:ital,wght@1,900&family=Quicksand:wght@700&display=swap" rel="stylesheet">
        <!--Bootstrap css link-->	
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
	       <!--css archivo-->
        <link rel="stylesheet" href="/Estilos/footer.css" />
        <link rel="stylesheet" href="/Estilos/header.css" />
        <link rel='stylesheet' type="text/css" href='/Estilos/perfilUsuario.css'>
        <!--Toart css link-->	
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
        <!--sweet2 css link-->	
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.3/dist/sweetalert2.min.js"></script>
        <!--sweet2 JAVASCRIPT link-->	
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.3/dist/sweetalert2.min.css">
        <style>

        </style>

    </head>
    <body>

                <!-- Header -->
      <div th:replace="Vistas/header :: .header"></div>
      
      
        <main class="contenido-perfil">
    <div class="container-md mt-5">
    <div class="row">
        <div class="col-md-3">
            <div class="card card-custom ">
                <div class="card-body">
                    <div>
                        <div class="d-grid justify-content-center text-center gap-3">

                            <img src="/Imagenes/usuario.png" width="80px" height="80px">
                            <p>Hola,</p>
                             <p th:text="${session.nombreUsuario}"></p>
                        </div>
               
                        <div>
                            <ul class="list-group list-group-flush ">
                                <li class="list-group-item"></li>
                                <a id="perfil" href="#/perfil" class="list-group-item activado"><li class="centrar "><span class="iconos-perfil"><i class="ri-user-line"></i> Perfil </span> <i class="ri-arrow-right-line "></i> </li></a>
                                
                                <a id="pedidos" href="#/pedidos" class="list-group-item " ><li class="centrar"><span class="iconos-perfil"><i class="ri-shopping-cart-line"></i> Mis Pedidos </span><i class="ri-arrow-right-line "></i></li></a>
                                <a id="listaD" href="#/listaDeseos" class="list-group-item " ><li class="centrar"><span class="iconos-perfil"><i class="ri-heart-line"></i> Lista Deseos </span><i class="ri-arrow-right-line "></i></li></a>
                                <a href="#" class="list-group-item"><li class="centrar"><span class="iconos-perfil"><i class="ri-logout-box-line"></i> Salir </span> <i class="ri-arrow-right-line "></i></li></a>
                                
                                <li class="list-group-item"></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-md-9 " id="perfil-editar">
            <div class="card">
                <div class="card-body">
                    <p class="iconos-perfil"><i class="ri-arrow-left-line "></i>PERFIL </p>
                    <h1>Editar Perfil</h1>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <form th:action="@{/actualizarPerfil}"  th:object="${editarPerfil}" method="post">
                                        <div class="form-group mb-4">
                                            <label for="nombre">Nombres:</label>
                                            <div class="input-group">
                                                <input type="hidden" class="form-control"  name="idUsuario" th:field="*{idCliente}">
                                                <input type="text" class="form-control"   name="nombres" th:field="*{nombres}">
                                                <i class="fas fa-user input-group-text tamaño"></i>
                                            </div>
                                        </div>
                                        <div class="form-group mb-4">
                                            <label for="edad">Edad del usuario:</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control"   name="edad" th:field="*{edad}">
                                                <i class="fas fa-calendar input-group-text tamaño"></i>
                                            </div>
                                        </div>
                                        <div class="form-group mb-4">
                                            <label for="direccion">Dirección del usuario:</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control"   name="direccion" th:field="*{direccion}">
                                                <i class="fas fa-home input-group-text tamaño"></i>
                                            </div>
                                        </div>
                                        <div class="form-group mb-4">
                                            <label for="correo">Correo del usuario:</label>
                                            <div class="input-group">
                                                <input type="email" class="form-control" name="correo" th:field="*{correo}">
                                                <i class="fas fa-envelope input-group-text tamaño"></i>
                                            </div>
                                        </div>
                                        <div class="form-group mb-4">
                                            <label for="usuario">Nombre de usuario:</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control"  name="usuario" readonly th:field="*{usuario}">
                                                <i class="fas fa-id-badge input-group-text tamaño"></i>
                                            </div>
                                        </div>
                                        <div class="form-group mb-4">
                                            <label for="password">Contraseña:</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="password"  name="password" th:field="*{password}">
                                                   <i class="fas ri-eye-line input-group-text tamaño" id="verContra"></i>
                                                   <i class="fas ri-eye-off-line input-group-text tamaño" id="ocultarContra"></i>                                            
                                            </div>
                                        </div>
                                        <div class="center">

                                            <button type="button" class="btn btn-success form-control" onclick="editarPerfil()">Guardar Cambios</button>
                                            <button type="submit" id="editarSubmit" style="display: none;"></button>        
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-9" id="listaDeseo-h" style="display: none;">
            <div class="card">
                <div class="card-body">
                    <div class="mb-5">
                        <h1 class="iconos-perfil"><i class="ri-arrow-left-line "></i> Mi Lista Deseos</h1>
                        <p >Aquí podrás encontrar toda tu lista de tus productos favoritos</p>       
                    </div>

                    <div>
                        <table class="table table-striped">
                            <thead class="table-dark text-center">
                                <tr>
                                    <th>#</th>
                                    <th>Imagen</th>
                                    <th>Producto</th>
                                    <th>Precio</th>   
                                    <th></th>
                                    <th></th>                   
                                </tr>  
                            </thead>
                            <tbody class="text-center">
                                <tr th:each="d,status :${listaDeseo}"  th:data-id="${d.idDeseo}">
                                    <td th:text="${status.index +1}"></td>
                                                                                <td>
                                   <img th:if="${#strings.startsWith(d.productos.imagen, 'http')}" th:src="${d.productos.imagen}" alt="Imagen del producto" height="100px" width="100px" />
								   <img th:unless="${#strings.startsWith(d.productos.imagen, 'http')}" th:src="@{'/Imagenes/Productos/' + ${d.productos.imagen}}" alt="Imagen del producto" height="100px" width="100px" />

                                  </td> 
                                    <td class="nombre-pro" th:text="${d.productos.nombre}" th:data-nombre="${d.productos.nombre}"></td>
                                    <td th:text="'S/. ' + ${#numbers.formatDecimal(d.productos.precio, 0, 'COMMA', 2, 'POINT')}"></td>
                                	<td>
									<!-- VISTA AGREGAR PRODUCTO DE LISTA DE DESEO AL CARRITO -->
       											    <div th:replace="Productos/agregarListaDeseoCarrito :: .agregarListaDeseoCarrito"></div>
									</td>
									<td>
											
											<button class="btn btn-danger" th:onclick="'confirmarEliminar(' + ${d.idDeseo} + ')'">Eliminar</button>	
									</td>
                                </tr>
                            </tbody>
                            
                        </table>
                    </div>
              
                </div>
            </div>
        </div>
        
           <div class="col-md-9" id="pedidos-h" style="display: none;">
            <div class="card">
                <div class="card-body">
                    <div class="mb-5">
                        <h1 class="iconos-perfil"><i class="ri-arrow-left-line "></i> Mis Pedidos</h1>
                        <p >Aquí podrás encontrar el historial de tus compras a detalle y toda la información relevante sobre tu despacho</p>
                     <!-- 
                        <select class="form-control w-50">
                            <option>Seleccione el Periodo</option>
                            <option>Últimos 30 Días</option>
                             <option>Último Año</option>
                        </select>-->
                    </div>

                    <div>
                        <table class="table table-striped">
                            <thead class="table-dark text-center">
                                <tr>
                                    <th>Pedido Nº</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Fecha de compra</th>
                                    <th>Estado</th>
                                    <th>Total</th>                        
                                </tr>  
                            </thead>
                            <tbody class="text-center">
                                <tr th:each="h :${historialVe}">
                                    <td th:text="${h.idHistorialVenta}"></td>
                                    <td th:text="${h.nomPro}"></td>
                                    <td th:text="${h.cantidad}"></td>
                                    <td th:text="${h.fechaVenta}"></td>
                                    <td th:text="${h.estado}"></td>
                                    <td th:text="'S/. ' + ${#numbers.formatDecimal(h.precioTotal, 0, 'COMMA', 2, 'POINT')}"></td>
                                  
                                </tr>
                            </tbody>
                            
                        </table>
                    </div>
              
                </div>
            </div>
        </div>
    </div>
    
    </div>
        </main>                   
			<!-- Footer -->
           <div th:replace="Vistas/footer :: .footer"></div>
        
                  
        <script src="https://kit.fontawesome.com/e0232df615.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

//PARA ELIMINAR EL PRODUCTO
<script>
		function confirmarEliminar(id) {
    Swal.fire({
        title: '¿Estás seguro?',
        text: "Esta acción no se puede deshacer",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, eliminarlo'
    }).then((result) => {
        if (result.isConfirmed) {
            eliminarDeseo(id);
        }
    });
}
	function eliminarDeseo(id) {
    // Realiza una solicitud AJAX DELETE al servidor
    var nombreProducto = $('tr[data-id="' + id + '"] .nombre-pro').data('nombre');
    $.ajax({
        url: '/eliminarDeseo/' + id, // Reemplaza con la ruta correcta del servidor y el ID del producto
        method: 'DELETE',
        success: function (response) {
            // La solicitud se completó con éxito ELIMINAR PRODUCTO DEL CRUD
            $('tr[data-id="' + id + '"]').remove();
            $('#listaDeseo').text(response); 
     	 toastr.success('El Producto' +' ' + nombreProducto, 'Producto Eliminado', {
                positionClass: 'toast-top-right',
                progressBar: true,
                timeOut: 2000,
                closeButton: true
                
            });
        },
        error: function (error) {
            // La solicitud falló
            console.error('Error al eliminar el producto:', error);
        }
    });
}

</script>

<script>
function editarPerfil() {
    // Si los campos no están vacíos, muestra la alerta de éxito
    Swal.fire({
        title: 'Datos Actualizado!',
        text: 'Hiciste clic en el botón!',
        icon: 'success',
        confirmButtonText: 'OK'
    }).then((result) => {
        // Si el usuario hace clic en "OK", activa el evento de clic del botón de enviar formulario
        if (result.isConfirmed) {
            // Encuentra el botón de enviar formulario por su ID y haz clic en él
            var submitButton = document.getElementById('editarSubmit');
            submitButton.click();
        }
    });
}
</script>
<script>
	
function contrasena(){
//OCULTAR CONTRASEÑA Y MOSTRARLA
var verContra = document.querySelector('#verContra');
var ocultarContra = document.querySelector('#ocultarContra');
var contra = document.querySelector('#password');

verContra.addEventListener('click', () => {
contra.type = "text";
ocultarContra.style.display = "block";
verContra.style.display = "none";
});
ocultarContra.addEventListener('click', () => {
contra.type = "password";
ocultarContra.style.display = "none";
verContra.style.display = "block";
});

}
contrasena();

function lista(){
// Obtener todos los enlaces dentro de elementos de la lista
var enlaces = document.querySelectorAll('.list-group a');

// Iterar sobre los enlaces y añadir un evento de clic a cada uno
enlaces.forEach(function(enlace) {
enlace.addEventListener('click', function() {
// Quitar la clase 'activado' de todos los enlaces
enlaces.forEach(function(enlace) {
enlace.classList.remove('activado');
});

// Añadir la clase 'activado' solo al enlace clicado
this.classList.add('activado');
});
});
}
lista();


function mostrarMenus(){
   var perfilClick = document.querySelector('#perfil');
   var pedidosClick = document.querySelector('#pedidos');
   var listaClick = document.querySelector('#listaD');
   var perfilE = document.querySelector('#perfil-editar');
   var pedidosH = document.querySelector('#pedidos-h');
   var listaD  = document.querySelector('#listaDeseo-h');

    perfilClick.addEventListener('click',()=>{
        pedidosH.style="display:none";
        listaD.style="display:none";
        perfilE.style="display:block";
    });

    pedidosClick.addEventListener('click',()=>{
        perfilE.style="display:none";
        listaD.style="display:none";
        pedidosH.style="display:block";
    });
    
    listaClick.addEventListener('click', () =>{
		perfilE.style="display:none";
        pedidosH.style="display:none";
		listaD.style="display:block";
	});
    
}
mostrarMenus();
</script>

    </body>
</html>
